(()=>{"use strict";const e=window.ReactJSXRuntime,{registerBlockType:t}=wp.blocks,{InspectorControls:i}=wp.blockEditor||wp.editor,{PanelBody:r,TextControl:o,ToggleControl:l,RangeControl:n,SelectControl:a,TextareaControl:s,ColorPicker:d,Button:c}=wp.components,{useEffect:p,useState:u}=wp.element,{apiFetch:x}=wp,{RichText:b}=wp.blockEditor,{MediaUpload:h,MediaUploadCheck:g}=wp.blockEditor,m=(e,t)=>{"undefined"!=typeof EWPDynamicAssetLoader&&"function"==typeof EWPDynamicAssetLoader.log&&EWPDynamicAssetLoader.log("[EWP Blocks] "+e,t)};"undefined"!=typeof wp&&wp.blocks&&wp.blockEditor&&wp.components&&wp.element&&"undefined"!=typeof ewp_blocks&&Object.keys(ewp_blocks).forEach(y=>{const f=ewp_blocks[y],j=`${f.namespace}/${f.name}`;m("Registering block: "+j),m("Block attributes",f.attributes),t(j,{apiVersion:3,title:f.title,icon:f.icon,category:f.category,attributes:{...f.attributes,isValid:{type:"boolean",default:!0}},edit:function(t){const{attributes:y,setAttributes:j}=t,k=Object.keys(f.attributes).reduce((e,t)=>{const i=f.attributes[t];return e[t]=y[t]||i.default||"",e},{}),[v,w]=u(""),[C,S]=u(k),[_,I]=u({}),[E,B]=u({}),R=(e,t)=>{f.attributes[e],S({...C,[e]:t}),j({[e]:t}),A(e,t)},A=(e,t)=>{f.attributes[e]?.required&&!t?(I(t=>({...t,[e]:`${f.attributes[e].label||e} is required.`})),j({isValid:!1})):(I(t=>{const{[e]:i,...r}=t;return r}),j({isValid:!0}))};p(()=>{const e={};Object.keys(f.attributes).forEach(t=>{const i=f.attributes[t],r=y[t]||i.default||"";e[t]=r}),j(e),S(e),m("Mount: flushed initial attribute values",e)},[]);const L=async e=>{const t={};for(const i of e)if(!E[i])try{const e=await x({path:`/wp/v2/media/${i}`});t[i]={url:e.media_details?.sizes?.thumbnail?.source_url||e.source_url,alt:e.alt_text||`Image ${i}`}}catch(e){m("Failed to fetch image data for ID "+i,e),t[i]={url:"",alt:`Image ${i}`}}Object.keys(t).length>0&&B(e=>({...e,...t}))};p(()=>{const e=new URLSearchParams(C).toString();x({path:`${f.namespace}/${f.name}/preview?${e}`}).then(e=>{m("Preview loaded for "+f.namespace+"/"+f.name,{htmlLength:e?e.length:0}),w(e);const t=new CustomEvent("ewp_dynamic_block_on_change",{detail:{response:e,block:f}});document.dispatchEvent(t),m("ewp_dynamic_block_on_change dispatched",{namespace:f.namespace,name:f.name})})},[JSON.stringify(C)]);const P=(e,t,i)=>{if(!e||"object"!=typeof e)return i;const r=e[t],o=e.attributes&&e.attributes[t],l=r??o;if(""===l||null==l)return i;const n=Number(l);return Number.isFinite(n)?n:i};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i,{children:(0,e.jsx)(r,{title:f.title+" Settings",initialOpen:!0,children:Object.entries(f.attributes).map(([i,r])=>{const u=r.required?`${r.label} *`:r.label,x=r.explanation?wp.element.createElement("small",{style:{display:"block",marginTop:"0px",marginBottom:"10px",letterSpacing:"normal",color:"#555",lineHeight:"1.5"}},r.explanation):null;switch(r.render_type){case"color":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(d,{color:t.attributes[i]||"",onChangeComplete:e=>R(i,e.hex),disableAlpha:!0})]},i);case"textarea":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",r.wp_editor?(0,e.jsx)(b,{tagName:"p",value:t.attributes[i]||"",onChange:e=>R(i,e),placeholder:r.placeholder||"",style:{border:"1px solid #ccd0d4",padding:"10px",borderRadius:"4px",backgroundColor:"#fff",minHeight:"150px"}}):(0,e.jsx)(s,{value:t.attributes[i]||"",onChange:e=>R(i,e),style:{border:"1px solid #ccd0d4",padding:"10px",borderRadius:"4px",backgroundColor:"#fff",minHeight:"150px"}})]},i);case"boolean":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(l,{checked:!!t.attributes[i],onChange:e=>R(i,e)})]},i);case"string":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(o,{value:t.attributes[i]||"",onChange:e=>R(i,e)})]},i);case"number":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(n,{value:t.attributes[i]??0,onChange:e=>R(i,e),min:P(r,"min",0),max:P(r,"max",100),step:P(r,"step",1)})]},i);case"select":const m=Array.isArray(r.options)?r.options.map(e=>({value:e.option,label:e.label})):[];return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(a,{value:t.attributes[i]||"",options:m,onChange:e=>R(i,e)})]},i);case"gallery":const y=t.attributes[i]||[],f=Array.isArray(y)?y:[];return p(()=>{f.length>0&&L(f)},[f.join(",")]),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x,(0,e.jsx)(g,{children:(0,e.jsx)(h,{onSelect:e=>{const t=e.map(e=>e.id);R(i,t)},allowedTypes:["image"],multiple:!0,gallery:!0,value:f,render:({open:t})=>(0,e.jsxs)("div",{children:[f.length>0&&(0,e.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:"8px",marginBottom:"15px"},children:f.map((t,r)=>{const o=E[t];return(0,e.jsxs)("div",{style:{position:"relative",width:"80px",height:"80px"},children:[o?.url?(0,e.jsx)("img",{src:o.url,alt:o.alt,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"}}):(0,e.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"#f0f0f0",borderRadius:"4px",border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"#666"},children:"Loading..."}),(0,e.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation();const r=f.filter(e=>e!==t);R(i,r)},type:"button",style:{position:"absolute",top:"2px",right:"2px",width:"18px",height:"18px",padding:"0",margin:"0",border:"1px solid white",borderRadius:"50%",backgroundColor:"#dc3545",color:"white",fontSize:"12px",fontWeight:"bold",lineHeight:"16px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",zIndex:"10"},onMouseEnter:e=>{e.target.style.backgroundColor="#c82333"},onMouseLeave:e=>{e.target.style.backgroundColor="#dc3545"},children:"×"})]},t)})}),(0,e.jsxs)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[(0,e.jsx)(c,{onClick:t,variant:"secondary",children:f.length>0?"Edit Gallery":"Select Images"}),f.length>0&&(0,e.jsx)(c,{onClick:()=>R(i,[]),variant:"secondary",isDestructive:!0,children:"Clear All Images"})]})]})})})]},i);case"image":const j=t.attributes[i]||"";p(()=>{j&&L([parseInt(j,10)])},[j]);const k=j?E[parseInt(j,10)]:null;return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x,(0,e.jsx)(g,{children:(0,e.jsx)(h,{onSelect:e=>{R(i,String(e.id))},allowedTypes:["image"],multiple:!1,gallery:!1,value:j?parseInt(j,10):void 0,render:({open:t})=>(0,e.jsxs)("div",{children:[j&&(0,e.jsxs)("div",{style:{position:"relative",width:"120px",height:"120px",marginBottom:"10px"},children:[k?.url?(0,e.jsx)("img",{src:k.url,alt:k.alt,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"}}):(0,e.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"#f0f0f0",borderRadius:"4px",border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"#666"},children:"Loading..."}),(0,e.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),R(i,"")},type:"button",style:{position:"absolute",top:"2px",right:"2px",width:"18px",height:"18px",padding:"0",margin:"0",border:"1px solid white",borderRadius:"50%",backgroundColor:"#dc3545",color:"white",fontSize:"12px",fontWeight:"bold",lineHeight:"16px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",zIndex:"10"},onMouseEnter:e=>{e.target.style.backgroundColor="#c82333"},onMouseLeave:e=>{e.target.style.backgroundColor="#dc3545"},children:"×"})]}),(0,e.jsx)(c,{onClick:t,variant:"secondary",children:j?"Change Image":"Select Image"})]})})})]},i);default:return null}})})}),(0,e.jsxs)("div",{className:t.className,children:[Object.keys(_).map(t=>(0,e.jsx)("p",{style:{color:"red"},children:_[t]},t)),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:v}})]})]})},save:function(e){return e.attributes.isValid,null}})})})();