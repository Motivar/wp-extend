(()=>{"use strict";const e=window.ReactJSXRuntime,{registerBlockType:t}=wp.blocks,{InspectorControls:r}=wp.blockEditor||wp.editor,{PanelBody:i,TextControl:l,ToggleControl:o,RangeControl:n,SelectControl:s,TextareaControl:a,ColorPicker:d,Button:c}=wp.components,{useEffect:p,useState:u}=wp.element,{apiFetch:x}=wp,{RichText:b}=wp.blockEditor,{MediaUpload:g,MediaUploadCheck:h}=wp.blockEditor;"undefined"!=typeof wp&&wp.blocks&&wp.blockEditor&&wp.components&&wp.element&&"undefined"!=typeof ewp_blocks&&Object.keys(ewp_blocks).forEach(m=>{const y=ewp_blocks[m],j=`${y.namespace}/${y.name}`;console.log("Registering block:",j),console.log("Block attributes:",y.attributes),t(j,{apiVersion:3,title:y.title,icon:y.icon,category:y.category,attributes:{...y.attributes,isValid:{type:"boolean",default:!0}},edit:function(t){const{attributes:m,setAttributes:j}=t,f=Object.keys(y.attributes).reduce((e,t)=>{const r=y.attributes[t];return e[t]=m[t]||r.default||"",e},{}),[k,w]=u(""),[v,C]=u(f),[S,I]=u({}),[B,_]=u({}),R=(e,t)=>{y.attributes[e],C({...v,[e]:t}),j({[e]:t}),E(e,t)},E=(e,t)=>{y.attributes[e]?.required&&!t?(I(t=>({...t,[e]:`${y.attributes[e].label||e} is required.`})),j({isValid:!1})):(I(t=>{const{[e]:r,...i}=t;return i}),j({isValid:!0}))},$=async e=>{const t={};for(const r of e)if(!B[r])try{const e=await x({path:`/wp/v2/media/${r}`});t[r]={url:e.media_details?.sizes?.thumbnail?.source_url||e.source_url,alt:e.alt_text||`Image ${r}`}}catch(e){console.warn(`Failed to fetch image data for ID ${r}:`,e),t[r]={url:"",alt:`Image ${r}`}}Object.keys(t).length>0&&_(e=>({...e,...t}))};p(()=>{const e=new URLSearchParams(v).toString();x({path:`${y.namespace}/${y.name}/preview?${e}`}).then(e=>{w(e);const t=new CustomEvent("ewp_dynamic_block_on_change",{detail:{response:e,block:y}});document.dispatchEvent(t)})},[JSON.stringify(v)]);const T=(e,t,r)=>{if(!e||"object"!=typeof e)return r;const i=e[t],l=e.attributes&&e.attributes[t],o=i??l;if(""===o||null==o)return r;const n=Number(o);return Number.isFinite(n)?n:r};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r,{children:(0,e.jsx)(i,{title:y.title+" Settings",initialOpen:!0,children:Object.entries(y.attributes).map(([r,i])=>{const u=i.required?`${i.label} *`:i.label,x=i.explanation?wp.element.createElement("small",{style:{display:"block",marginTop:"0px",marginBottom:"10px",letterSpacing:"normal",color:"#555",lineHeight:"1.5"}},i.explanation):null;switch(i.render_type){case"color":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(d,{color:t.attributes[r]||"",onChangeComplete:e=>R(r,e.hex),disableAlpha:!0})]},r);case"textarea":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",i.wp_editor?(0,e.jsx)(b,{tagName:"p",value:t.attributes[r]||"",onChange:e=>R(r,e),placeholder:i.placeholder||"",style:{border:"1px solid #ccd0d4",padding:"10px",borderRadius:"4px",backgroundColor:"#fff",minHeight:"150px"}}):(0,e.jsx)(a,{value:t.attributes[r]||"",onChange:e=>R(r,e),style:{border:"1px solid #ccd0d4",padding:"10px",borderRadius:"4px",backgroundColor:"#fff",minHeight:"150px"}})]},r);case"boolean":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(o,{checked:!!t.attributes[r],onChange:e=>R(r,e)})]},r);case"string":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(l,{value:t.attributes[r]||"",onChange:e=>R(r,e)})]},r);case"number":return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(n,{value:t.attributes[r]??0,onChange:e=>R(r,e),min:T(i,"min",0),max:T(i,"max",100),step:T(i,"step",1)})]},r);case"select":const m=Array.isArray(i.options)?i.options.map(e=>({value:e.option,label:e.label})):[];return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x," ",(0,e.jsx)(s,{value:t.attributes[r]||"",options:m,onChange:e=>R(r,e)})]},r);case"gallery":const y=t.attributes[r]||[],j=Array.isArray(y)?y:[];return p(()=>{j.length>0&&$(j)},[j.join(",")]),(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x,(0,e.jsx)(h,{children:(0,e.jsx)(g,{onSelect:e=>{const t=e.map(e=>e.id);R(r,t)},allowedTypes:["image"],multiple:!0,gallery:!0,value:j,render:({open:t})=>(0,e.jsxs)("div",{children:[j.length>0&&(0,e.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(80px, 1fr))",gap:"8px",marginBottom:"15px"},children:j.map((t,i)=>{const l=B[t];return(0,e.jsxs)("div",{style:{position:"relative",width:"80px",height:"80px"},children:[l?.url?(0,e.jsx)("img",{src:l.url,alt:l.alt,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"}}):(0,e.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"#f0f0f0",borderRadius:"4px",border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"#666"},children:"Loading..."}),(0,e.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation();const i=j.filter(e=>e!==t);R(r,i)},type:"button",style:{position:"absolute",top:"2px",right:"2px",width:"18px",height:"18px",padding:"0",margin:"0",border:"1px solid white",borderRadius:"50%",backgroundColor:"#dc3545",color:"white",fontSize:"12px",fontWeight:"bold",lineHeight:"16px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",zIndex:"10"},onMouseEnter:e=>{e.target.style.backgroundColor="#c82333"},onMouseLeave:e=>{e.target.style.backgroundColor="#dc3545"},children:"×"})]},t)})}),(0,e.jsxs)("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[(0,e.jsx)(c,{onClick:t,variant:"secondary",children:j.length>0?"Edit Gallery":"Select Images"}),j.length>0&&(0,e.jsx)(c,{onClick:()=>R(r,[]),variant:"secondary",isDestructive:!0,children:"Clear All Images"})]})]})})})]},r);case"image":const f=t.attributes[r]||"";p(()=>{f&&$([parseInt(f,10)])},[f]);const k=f?B[parseInt(f,10)]:null;return(0,e.jsxs)("div",{children:[(0,e.jsx)("label",{style:{display:"block",marginBottom:"4px"},children:u}),x,(0,e.jsx)(h,{children:(0,e.jsx)(g,{onSelect:e=>{R(r,String(e.id))},allowedTypes:["image"],multiple:!1,gallery:!1,value:f?parseInt(f,10):void 0,render:({open:t})=>(0,e.jsxs)("div",{children:[f&&(0,e.jsxs)("div",{style:{position:"relative",width:"120px",height:"120px",marginBottom:"10px"},children:[k?.url?(0,e.jsx)("img",{src:k.url,alt:k.alt,style:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"4px",border:"1px solid #ddd"}}):(0,e.jsx)("div",{style:{width:"100%",height:"100%",backgroundColor:"#f0f0f0",borderRadius:"4px",border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",color:"#666"},children:"Loading..."}),(0,e.jsx)("button",{onClick:e=>{e.preventDefault(),e.stopPropagation(),R(r,"")},type:"button",style:{position:"absolute",top:"2px",right:"2px",width:"18px",height:"18px",padding:"0",margin:"0",border:"1px solid white",borderRadius:"50%",backgroundColor:"#dc3545",color:"white",fontSize:"12px",fontWeight:"bold",lineHeight:"16px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",boxShadow:"0 1px 3px rgba(0,0,0,0.3)",zIndex:"10"},onMouseEnter:e=>{e.target.style.backgroundColor="#c82333"},onMouseLeave:e=>{e.target.style.backgroundColor="#dc3545"},children:"×"})]}),(0,e.jsx)(c,{onClick:t,variant:"secondary",children:f?"Change Image":"Select Image"})]})})})]},r);default:return null}})})}),(0,e.jsxs)("div",{className:t.className,children:[Object.keys(S).map(t=>(0,e.jsx)("p",{style:{color:"red"},children:S[t]},t)),(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:k}})]})]})},save:function(e){return e.attributes.isValid,null}})})})();